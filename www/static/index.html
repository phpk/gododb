<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="icon" href="/static/favicon.ico" type="image/vnd.microsoft.icon" />
    <title>管理首页</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 样 式 文 件 -->
    <link rel="stylesheet" href="/static/css/layui.css" />
</head>

<body>
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header">
            <!-- 头部区域（可配合layui 已有的水平导航） -->
            <ul class="layui-nav" id="menuarea" lay-filter="filter-nav">
                <!-- 移动端显示 -->
                
            </ul>
            <script id="menutpl" type="text/html">
                <li class="layui-nav-item layui-this" >
                    <a href="javascript:;" url="./res/index/welcome.html">首页</a>
                </li>
                {{#  layui.each(d, function(index, item){ }}
                <li class="layui-nav-item">
                    <a href="javascript:;"{{#  if(item.href){ }} url="{{= item.href }}"{{#  } }}>{{= item.title }}</a>
                    {{#  if(item.children.length > 0){ }}
                    <dl class="layui-nav-child">
                        {{#  layui.each(item.children, function(ckey, citem){ }}
                        <dd><a href="javascript:;"{{#  if(citem.href){ }} url="{{= citem.href }}"{{#  } }}>{{= citem.title }}</a></dd>
                        {{#  }); }}
                    </dl>
                    {{#  } }}
                </li>
                {{#  }); }}
            </script>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;"><i class="layui-icon layui-icon-set"
                            style="font-size: 20px; color: #ffffff;"></i></a>
                </li>
                <li class="layui-nav-item" id="loginOut">
                    <a href="javascript:;"><i class="layui-icon layui-icon-logout"
                            style="font-size: 20px; color: #ffffff;"></i></a>
                </li>


            </ul>
        </div>

        <div class="layui-body" style="width: 100%;left:0;">
            <!-- 内容主体区域 -->
            <iframe style="width:100%;height:100%;" scrolling="auto" frameborder="0" id="appframe"
                        src="./res/index/welcome.html"></iframe>
        </div>
        <div class="layui-footer" style="width: 100%;left:0;text-align: center;">
            <!-- 底部固定区域 -->
            Copyright &copy; 2023 <a href="http://gdoa.top/" target="_blank">GodoOA</a> LGPL Licensed
        </div>
    </div>
    <script src="/static/js/layui.js"></script>
    <script>
        //JS 
        function setIframeHeight(iframe) {
            if (iframe) {
                var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;//兼容
                if (iframeWin.document.body) {
                    iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;//滚动条高度
                }
            }
        };

        window.onload = function () {
            setIframeHeight(document.getElementById('appframe'));
        };
        function setIframeUrl(url) {
            document.getElementById('appframe').src = url;
        }
        layui.extend({
				api: '{/}/static/js/api' // 开头特定符 {/} 即代表采用单独路径
		}).use(['api'], function () {
            let element = layui.element,
            layer = layui.layer,
            laytpl = layui.laytpl,
            util = layui.util,
            $ = layui.$,
            api = layui.api;
            let menuData = api.getMenu();
            // 渲染并输出结果
            //console.log(menuData)
            laytpl($("#menutpl").html()).render(menuData, function(str){
              $('#menuarea').html(str)
            });
            element.render('nav', 'filter-nav');
            $('#menuarea').on("click", "a", e=>{
                //console.log(e)
                let url = $(e.target).attr('url');
                //console.log(url)
                if(url){
                    $('#appframe').attr("src", url)
                }
                
            })

            $("#loginOut").click(e => {
                layer.confirm('确认要退出？', {icon: 3}, function(){
                    api.get('login/loginOut', res => {
                        api.clearToken();
                        location.href = '/static/login.html'
                    })
                  });
                
            })

        });
    </script>
</body>

</html>